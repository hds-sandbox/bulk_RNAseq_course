<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This course is an introduction for how to approach bulk RNAseq data, starting from the sequencing reads.  It will provide an overview of the fundamentals of RNAseq analysis, including read preprocessing, data normalization, data exploration with PCAs and heatmaps, performing differential expression analysis and annotation of the differentially expressed genes.  Participants will also learn how to evaluate confounding and batch effects in the data.  The course will further touch upon laboratory protocols, library preparation, and experimental design of RNA sequencing experiments, especially about how they influence downstream bioinformatic analysis.   "><meta name=author content="Jose Alejandro Romero Herrera"><link rel=canonical href=https://github.com/hds-sandbox/bulk_RNAseq_course/07_extra_contrast_design.html><link rel=icon href=images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-8.5.10"><title>Contrast designs - Bulk RNAseq data analysis</title><link rel=stylesheet href=assets/stylesheets/main.975780f9.min.css><link rel=stylesheet href=assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=stylesheets/extra.css><script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=brightness data-md-color-primary data-md-color-accent> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#design-formula-and-contrasts class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=http://hds-sandbox.github.io/ title="Bulk RNAseq data analysis" class="md-header__button md-logo" aria-label="Bulk RNAseq data analysis" data-md-component=logo> <img src=images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Bulk RNAseq data analysis </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Contrast designs </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=brightness data-md-color-primary data-md-color-accent aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary data-md-color-accent aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/hds-sandbox/bulk_RNAseq_course title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> hds-sandbox/bulk_RNAseq_course </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=index.html class=md-tabs__link> Course Introduction </a> </li> <li class=md-tabs__item> <a href=02_experimental_planning.html class=md-tabs__link> Experimental planning </a> </li> <li class=md-tabs__item> <a href=03_data_explanation.html class=md-tabs__link> Data Explanation </a> </li> <li class=md-tabs__item> <a href=04a_preprocessing.html class=md-tabs__link> Read Preprocessing </a> </li> <li class=md-tabs__item> <a href=05a_data_analysis_setup.html class="md-tabs__link md-tabs__link--active"> Analysing RNAseq data </a> </li> <li class=md-tabs__item> <a href=09_summarized_workflow.html class=md-tabs__link> Summarized workflow </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=http://hds-sandbox.github.io/ title="Bulk RNAseq data analysis" class="md-nav__button md-logo" aria-label="Bulk RNAseq data analysis" data-md-component=logo> <img src=images/logo.png alt=logo> </a> Bulk RNAseq data analysis </label> <div class=md-nav__source> <a href=https://github.com/hds-sandbox/bulk_RNAseq_course title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> hds-sandbox/bulk_RNAseq_course </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=index.html class=md-nav__link> Course Introduction </a> </li> <li class=md-nav__item> <a href=02_experimental_planning.html class=md-nav__link> Experimental planning </a> </li> <li class=md-nav__item> <a href=03_data_explanation.html class=md-nav__link> Data Explanation </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Read Preprocessing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Read Preprocessing" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Read Preprocessing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=04a_preprocessing.html class=md-nav__link> Preprocessing steps </a> </li> <li class=md-nav__item> <a href=04b_pipelines.html class=md-nav__link> Nextflow and nf-core pipelines </a> </li> <li class=md-nav__item> <a href=04c_preprocessing_setup.html class=md-nav__link> UCloud setup </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5> Analysing RNAseq data <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Analysing RNAseq data" data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Analysing RNAseq data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=05a_data_analysis_setup.html class=md-nav__link> Ucloud setup </a> </li> <li class=md-nav__item> <a href=05b_count_matrix.html class=md-nav__link> Count matrix </a> </li> <li class=md-nav__item> <a href=05c_count_normalization.html class=md-nav__link> Normalization </a> </li> <li class=md-nav__item> <a href=06_exploratory_analysis.html class=md-nav__link> Exploratory Analysis </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_5 type=checkbox id=__nav_5_5 checked> <label class=md-nav__link for=__nav_5_5> Differential Expression <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Differential Expression" data-md-level=2> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> Differential Expression </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Design formula <span class="md-nav__icon md-icon"></span> </label> <a href=07_extra_contrast_design.html class="md-nav__link md-nav__link--active"> Design formula </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#design-formula class=md-nav__link> Design formula </a> </li> <li class=md-nav__item> <a href=#one-factor-two-levels class=md-nav__link> One factor, two levels </a> </li> <li class=md-nav__item> <a href=#recoding-the-design class=md-nav__link> Recoding the design </a> </li> <li class=md-nav__item> <a href=#one-factor-three-levels class=md-nav__link> One factor, three levels </a> <nav class=md-nav aria-label="One factor, three levels"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#a-and-b-against-o class=md-nav__link> A and B against O </a> </li> <li class=md-nav__item> <a href=#extra-why-not-define-a-new-group-in-our-design-matrix class=md-nav__link> Extra: why not define a new group in our design matrix? </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#two-factors-with-interaction class=md-nav__link> Two factors with interaction </a> </li> <li class=md-nav__item> <a href=#three-factors-with-nesting class=md-nav__link> Three factors, with nesting </a> </li> <li class=md-nav__item> <a href=#extra-imbalanced-design class=md-nav__link> Extra: imbalanced design </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=07a_DEA.html class=md-nav__link> DESeq2 </a> </li> <li class=md-nav__item> <a href=07b_hypothesis_testing.html class=md-nav__link> Hypothesis testing </a> </li> <li class=md-nav__item> <a href=07c_DEA_visualization.html class=md-nav__link> Visualization </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_6 type=checkbox id=__nav_5_6> <label class=md-nav__link for=__nav_5_6> Functional Analysis <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Functional Analysis" data-md-level=2> <label class=md-nav__title for=__nav_5_6> <span class="md-nav__icon md-icon"></span> Functional Analysis </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=08a_FA_genomic_annotation.html class=md-nav__link> Gene annotation </a> </li> <li class=md-nav__item> <a href=08b_FA_overrepresentation.html class=md-nav__link> Over representation analysis </a> </li> <li class=md-nav__item> <a href=08c_FA_GSEA.html class=md-nav__link> Class scoring </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=09_summarized_workflow.html class=md-nav__link> Summarized workflow </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#design-formula class=md-nav__link> Design formula </a> </li> <li class=md-nav__item> <a href=#one-factor-two-levels class=md-nav__link> One factor, two levels </a> </li> <li class=md-nav__item> <a href=#recoding-the-design class=md-nav__link> Recoding the design </a> </li> <li class=md-nav__item> <a href=#one-factor-three-levels class=md-nav__link> One factor, three levels </a> <nav class=md-nav aria-label="One factor, three levels"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#a-and-b-against-o class=md-nav__link> A and B against O </a> </li> <li class=md-nav__item> <a href=#extra-why-not-define-a-new-group-in-our-design-matrix class=md-nav__link> Extra: why not define a new group in our design matrix? </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#two-factors-with-interaction class=md-nav__link> Two factors with interaction </a> </li> <li class=md-nav__item> <a href=#three-factors-with-nesting class=md-nav__link> Three factors, with nesting </a> </li> <li class=md-nav__item> <a href=#extra-imbalanced-design class=md-nav__link> Extra: imbalanced design </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/hds-sandbox/bulk_RNAseq_course/edit/master/docs/07_extra_contrast_design.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=design-formula-and-contrasts>Design formula and contrasts<a class=headerlink href=#design-formula-and-contrasts title="Permanent link">&para;</a></h1> <div class="admonition note"> <p class=admonition-title>Section Overview</p> <p>&#128368; <strong>Time Estimation:</strong> 40 minutes </p> <p>&#128172; <strong>Learning Objectives:</strong> </p> <ol> <li>Demonstrate the use of the design formula with simple and complex designs</li> <li>Construct R code to execute the differential expression analysis workflow with DESeq2</li> </ol> </div> <p>The final step in the differential expression analysis workflow is <strong>fitting the raw counts to the NB model and performing the statistical test</strong> for differentially expressed genes. In this step we essentially want to determine whether the mean expression levels of different sample groups are significantly different.</p> <p><img src=./img/07_extra_contrast_design/de_theory.png width=1109 style="display: block; margin: auto;"></p> <p><em>Image credit: Paul Pavlidis, UBC</em></p> <p>The <a href=https://genomebiology.biomedcentral.com/articles/10.1186/s13059-014-0550-8>DESeq2 paper</a> was published in 2014, but the package is continually updated and available for use in R through Bioconductor. It builds on good ideas for dispersion estimation and use of Generalized Linear Models from the <a href=https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4005660/ >DSS</a> and <a href=https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2796818/ >edgeR</a> methods.</p> <p>Differential expression analysis with DESeq2 involves multiple steps as displayed in the flowchart below in blue. Briefly, DESeq2 will model the raw counts, using normalization factors (size factors) to account for differences in library depth. Then, it will estimate the gene-wise dispersions and shrink these estimates to generate more accurate estimates of dispersion to model the counts. Finally, DESeq2 will fit the negative binomial model and perform hypothesis testing using the Wald test or Likelihood Ratio Test.</p> <p><img src=./img/07_extra_contrast_design/deseq_workflow1.png width=322 style="display: block; margin: auto;"></p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>DESeq2 is actively maintained by the developers and continuously being updated. As such, it is important that you note the version you are working with. Recently, there have been some rather <strong>big changes implemented</strong> that impact the output. To find out more detail about the specific <strong>modifications made to methods described in the original 2014 paper</strong>, take a look at <a href=http://bioconductor.org/packages/devel/bioc/vignettes/DESeq2/inst/doc/DESeq2.html#methods-changes-since-the-2014-deseq2-paper>this section in the DESeq2 vignette</a>.</p> <p>Additional details on the statistical concepts underlying DESeq2 are elucidated nicely in Rafael Irizarry's <a href=https://rafalab.github.io/pages/harvardx.html>materials</a> for the EdX course, "Data Analysis for the Life Sciences Series". ## Running DESeq2</p> </div> <p>Prior to performing the differential expression analysis, it is a good idea to know what <strong>sources of variation</strong> are present in your data, either by exploration during the QC and/or prior knowledge. Once you know the major sources of variation, you can remove them prior to analysis or control for them in the statistical model by including them in your <strong>design formula</strong>.</p> <h2 id=design-formula>Design formula<a class=headerlink href=#design-formula title="Permanent link">&para;</a></h2> <p>A design formula tells the statistical software the known sources of variation to control for, as well as, the factor of interest to test for during differential expression testing. For example, if you know that sex is a significant source of variation in your data, then <code>sex</code> should be included in your model. <strong>The design formula should have all of the factors in your metadata that account for major sources of variation in your data. The last factor entered in the formula should be the condition of interest.</strong></p> <p>For example, suppose you have the following metadata:</p> <p><img src=./img/07_extra_contrast_design/metadata.png width=270 style="display: block; margin: auto;"></p> <p>If you want to examine the expression differences between <code>condition</code>, and you know that major sources of variation include <code>bloodtype</code> and <code>patient</code>, then your design formula would be:</p> <p><code>design = ~ bloodtype + patient + condition</code></p> <p>The tilde (<code>~</code>) should always precede your factors and tells DESeq2 to model the counts using the following formula. Note the <strong>factors included in the design formula need to match the column names in the metadata</strong>.</p> <p>In this tutorial we show a general and flexible way to define contrasts, and is often useful for more complex contrasts or when the design of the experiment is imbalanced (e.g. different number of replicates in each group). Although we focus on <strong>DESeq2</strong>, the approach can also be used with the other popular package <strong>edgeR</strong>.</p> <p>Each section below covers a particular experimental design, from simpler to more complex ones. The first chunk of code in each section is to simulate data, which has no particular meaning and is only done in order to have a DESeqDataSet object with the right kind of variables for each example. In practice, users can ignore this step as they should have created a DESeqDataSet object from their own data following the <a href=https://bioconductor.org/packages/devel/bioc/vignettes/DESeq2/inst/doc/DESeq2.html#the-deseqdataset>instructions in the vignette</a>.</p> <h2 id=one-factor-two-levels>One factor, two levels<a class=headerlink href=#one-factor-two-levels title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1># simulate data</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=n>dds</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>makeExampleDESeqDataSet</span><span class=p>(</span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>1000</span><span class=p>,</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>6</span><span class=p>,</span><span class=w> </span><span class=n>betaSD</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>2</span><span class=p>)</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>factor</span><span class=p>(</span><span class=nf>rep</span><span class=p>(</span><span class=nf>c</span><span class=p>(</span><span class=s>&quot;control&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;treat&quot;</span><span class=p>),</span><span class=w> </span><span class=n>each</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>3</span><span class=p>))</span>
</code></pre></div> <p>First we can look at our sample information:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=nf>colData</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>## DataFrame with 6 rows and 1 column
##         condition
##          &lt;factor&gt;
## sample1   control
## sample2   control
## sample3   control
## sample4   treat  
## sample5   treat  
## sample6   treat
</code></pre></div> <p>Our factor of interest is <code>condition</code> and so we define our design and run the DESeq model fitting routine:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=nf>design</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=o>~</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>condition</span><span class=w> </span><span class=c1># or just `~ condition`</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=n>dds</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>DESeq</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span><span class=w> </span><span class=c1># equivalent to edgeR::glmFit()</span>
</code></pre></div> <p>Then check what coefficients DESeq estimated:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nf>resultsNames</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>## [1] &quot;Intercept&quot;                  &quot;condition_treat_vs_control&quot;
</code></pre></div> <p>We can see that we have a coefficient for our <code>intercept</code> and coefficient for the effect of <code>treat</code> (i.e. differences between treat versus control).</p> <p>Using the more standard syntax, we can obtain the results for the effect of treat as such:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=n>res1</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>list</span><span class=p>(</span><span class=s>&quot;condition_treat_vs_control&quot;</span><span class=p>))</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=n>res1</span>
</code></pre></div> <div class=highlight><pre><span></span><code>## log2 fold change (MLE): condition_treat_vs_control effect 
## Wald test p-value: condition_treat_vs_control effect 
## DataFrame with 1000 rows and 6 columns
##           baseMean log2FoldChange     lfcSE         stat      pvalue
##          &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt;   &lt;numeric&gt;
## gene1     40.90941    1.267525859  0.574144  2.207679752   0.0272666
## gene2     12.21876   -0.269917301  1.111127 -0.242922069   0.8080658
## gene3      1.91439   -3.538133611  2.564464 -1.379677442   0.1676860
## gene4     10.24472    0.954811627  1.166408  0.818591708   0.4130194
## gene5     13.16824    0.000656519  0.868780  0.000755679   0.9993971
## ...            ...            ...       ...          ...         ...
## gene996   40.43827     -1.0291276  0.554587    -1.855664 0.063501471
## gene997   52.88360      0.0622133  0.561981     0.110704 0.911851377
## gene998   73.06582      1.3271896  0.576695     2.301373 0.021370581
## gene999    8.87701     -5.8385374  1.549471    -3.768084 0.000164506
## gene1000  37.06533      1.2669314  0.602010     2.104501 0.035334764
##                 padj
##            &lt;numeric&gt;
## gene1      0.0712378
## gene2      0.8779871
## gene3      0.2943125
## gene4      0.5692485
## gene5      0.9996728
## ...              ...
## gene996  0.138827354
## gene997  0.948279388
## gene998  0.059599481
## gene999  0.000914882
## gene1000 0.087737235
</code></pre></div> <p>The above is a simple way to obtain the results of interest. But it is worth understanding how DESeq is getting to these results by looking at the model’s matrix. DESeq defines the model matrix using base R functionality:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=nf>model.matrix</span><span class=p>(</span><span class=nf>design</span><span class=p>(</span><span class=n>dds</span><span class=p>),</span><span class=w> </span><span class=nf>colData</span><span class=p>(</span><span class=n>dds</span><span class=p>))</span>
</code></pre></div> <div class=highlight><pre><span></span><code>##         (Intercept) conditiontreat
## sample1           1              0
## sample2           1              0
## sample3           1              0
## sample4           1              1
## sample5           1              1
## sample6           1              1
## attr(,&quot;assign&quot;)
## [1] 0 1
## attr(,&quot;contrasts&quot;)
## attr(,&quot;contrasts&quot;)$condition
## [1] &quot;contr.treatment&quot;
</code></pre></div> <p>We can see that R coded <code>condition</code> as a dummy variable, with an intercept (common to all samples) and a "conditiontreat" variable, which adds the effect of treat to samples 4-6.</p> <p>We can actually set our contrasts in <code>DESeq2::results()</code> using a numeric vector. The way it works is to define a vector of "weights" for the coefficient(s) we want to test for. In this case, we have <code>(Intercept)</code> and <code>conditiontreat</code> as our coefficients (see model matrix above), and we want to test for the effect of treat, so our contrast vector would be <code>c(0, 1)</code>. In other words, we don’t care about the value of <code>(Intercept)</code> (so it has a weight of 0), and we’re only interested in the effect of treat (so we give it a weight of 1).</p> <p>In this case the design is very simple, so we could define our contrast vector "manually". But for complex designs this can get more difficult to do, so it’s worth mentioning the general way in which we can define this. For any contrast of interest, we can follow three steps:</p> <ul> <li>Get the model matrix</li> <li>Subset the matrix for each group of interest and calculate its column means - this results in a vector of coefficients for each group</li> <li>Subtract the group vectors from each other according to the comparison we’re interested in</li> </ul> <p>Let’s see this example in action:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1># get the model matrix</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=n>mod_mat</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>model.matrix</span><span class=p>(</span><span class=nf>design</span><span class=p>(</span><span class=n>dds</span><span class=p>),</span><span class=w> </span><span class=nf>colData</span><span class=p>(</span><span class=n>dds</span><span class=p>))</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=n>mod_mat</span>
</code></pre></div> <div class=highlight><pre><span></span><code>##         (Intercept) conditiontreat
## sample1           1              0
## sample2           1              0
## sample3           1              0
## sample4           1              1
## sample5           1              1
## sample6           1              1
## attr(,&quot;assign&quot;)
## [1] 0 1
## attr(,&quot;contrasts&quot;)
## attr(,&quot;contrasts&quot;)$condition
## [1] &quot;contr.treatment&quot;
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c1># calculate the vector of coefficient weights in the treat</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=n>treat</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;treat&quot;</span><span class=p>,</span><span class=w> </span><span class=p>])</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=n>treat</span>
</code></pre></div> <div class=highlight><pre><span></span><code>##    (Intercept) conditiontreat 
##              1              1
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1># calculate the vector of coefficient weights in the control</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=n>control</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;control&quot;</span><span class=p>,</span><span class=w> </span><span class=p>])</span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=n>control</span>
</code></pre></div> <div class=highlight><pre><span></span><code>##    (Intercept) conditiontreat 
##              1              0
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1># The contrast we are interested in is the difference between treat and control</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=n>treat</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>control</span>
</code></pre></div> <div class=highlight><pre><span></span><code>##    (Intercept) conditiontreat 
##              0              1
</code></pre></div> <p>That last step is where we define our contrast vector, and we can give this directly to the <code>results</code> function:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1># get the results for this contrast</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=n>res2</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>treat</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>control</span><span class=p>)</span>
</code></pre></div> <p>This gives us exactly the same results as before, which we can check for example by plotting the log-fold-changes between the first and second approach:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=nf>plot</span><span class=p>(</span><span class=n>res1</span><span class=o>$</span><span class=n>log2FoldChange</span><span class=p>,</span><span class=w> </span><span class=n>res2</span><span class=o>$</span><span class=n>log2FoldChange</span><span class=p>)</span>
</code></pre></div> <p><img src=./img/07_extra_contrast_design/contrast_res1.png width=960 style="display: block; margin: auto;"></p> <h2 id=recoding-the-design>Recoding the design<a class=headerlink href=#recoding-the-design title="Permanent link">&para;</a></h2> <p>Often, we can use different model matrices that essentially correspond to the same design. For example, we could recode our design above by removing the intercept:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=nf>design</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=o>~</span><span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>condition</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=n>dds</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>DESeq</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=nf>resultsNames</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>## [1] &quot;conditioncontrol&quot; &quot;conditiontreat&quot;
</code></pre></div> <p>In this case we get a coefficient corresponding to the average expression in control and the average expression in the treat (rather than the <em>difference</em> between treat and control).</p> <p>If we use the same contrast trick as before (using the model matrix), we can see the result is the same:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=c1># get the model matrix</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=n>mod_mat</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>model.matrix</span><span class=p>(</span><span class=nf>design</span><span class=p>(</span><span class=n>dds</span><span class=p>),</span><span class=w> </span><span class=nf>colData</span><span class=p>(</span><span class=n>dds</span><span class=p>))</span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=n>mod_mat</span>
</code></pre></div> <div class=highlight><pre><span></span><code>##         conditioncontrol conditiontreat
## sample1                1              0
## sample2                1              0
## sample3                1              0
## sample4                0              1
## sample5                0              1
## sample6                0              1
## attr(,&quot;assign&quot;)
## [1] 1 1
## attr(,&quot;contrasts&quot;)
## attr(,&quot;contrasts&quot;)$condition
## [1] &quot;contr.treatment&quot;
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=c1># calculate weights for coefficients in each condition</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=n>treat</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=nf>which</span><span class=p>(</span><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;treat&quot;</span><span class=p>),</span><span class=w> </span><span class=p>])</span>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=n>control</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=nf>which</span><span class=p>(</span><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;control&quot;</span><span class=p>),</span><span class=w> </span><span class=p>])</span>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=c1># get the results for our contrast</span>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=n>res3</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>treat</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>control</span><span class=p>)</span>
</code></pre></div> <p>Again, the results are essentially the same:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=nf>plot</span><span class=p>(</span><span class=n>res1</span><span class=o>$</span><span class=n>log2FoldChange</span><span class=p>,</span><span class=w> </span><span class=n>res3</span><span class=o>$</span><span class=n>log2FoldChange</span><span class=p>)</span>
</code></pre></div> <p><img src=./img/07_extra_contrast_design/contrast_res2.png width=960 style="display: block; margin: auto;"></p> <p>In theory there’s no difference between these two ways of defining our design. The design with an intercept is more common, but for the purposes of understanding what’s going on, it’s sometimes easier to look at models without intercept.</p> <h2 id=one-factor-three-levels>One factor, three levels<a class=headerlink href=#one-factor-three-levels title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=c1># simulate data</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=n>dds</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>makeExampleDESeqDataSet</span><span class=p>(</span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>1000</span><span class=p>,</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>9</span><span class=p>,</span><span class=w> </span><span class=n>betaSD</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>2</span><span class=p>)</span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=kc>NULL</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>factor</span><span class=p>(</span><span class=nf>rep</span><span class=p>(</span><span class=nf>c</span><span class=p>(</span><span class=s>&quot;bloodA&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;bloodB&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;bloodO&quot;</span><span class=p>),</span><span class=w> </span><span class=n>each</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>3</span><span class=p>))</span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>relevel</span><span class=p>(</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=p>,</span><span class=w> </span><span class=s>&quot;bloodO&quot;</span><span class=p>)</span>
</code></pre></div> <p>First we can look at our sample information:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=nf>colData</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>## DataFrame with 9 rows and 1 column
##         bloodtype
##          &lt;factor&gt;
## sample1    bloodA
## sample2    bloodA
## sample3    bloodA
## sample4    bloodB
## sample5    bloodB
## sample6    bloodB
## sample7    bloodO
## sample8    bloodO
## sample9    bloodO
</code></pre></div> <p>As in the previous example, we only have one factor of interest, <code>bloodtype</code>, and so we define our design and run the DESeq as before:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=nf>design</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=o>~</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>bloodtype</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=n>dds</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>DESeq</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=c1># check the coefficients estimated by DEseq</span>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=nf>resultsNames</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>## [1] &quot;Intercept&quot;                  &quot;bloodtype_bloodA_vs_bloodO&quot;
## [3] &quot;bloodtype_bloodB_vs_bloodO&quot;
</code></pre></div> <p>We see that now we have 3 coefficients:</p> <ul> <li>"Intercept" corresponds to bloodO bloodtype (our reference level)</li> <li>"bloodtype_bloodA_vs_bloodO" corresponds to the difference between the reference level and bloodA</li> <li>"bloodtype_bloodB_vs_bloodO" corresponds to the difference between the reference level and bloodB</li> </ul> <p>We could obtain the difference between bloodO and any of the two bloodtypes easily:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=n>res1_bloodA_bloodO</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>list</span><span class=p>(</span><span class=s>&quot;bloodtype_bloodA_vs_bloodO&quot;</span><span class=p>))</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=n>res1_bloodB_bloodO</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>list</span><span class=p>(</span><span class=s>&quot;bloodtype_bloodB_vs_bloodO&quot;</span><span class=p>))</span>
</code></pre></div> <p>For comparing bloodA vs bloodB, however, we need to compare two coefficients with each other to check whether they are themselves different (check the slide to see the illustration). This is how the standard DESeq syntax would be:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=n>res1_bloodA_bloodB</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>list</span><span class=p>(</span><span class=s>&quot;bloodtype_bloodA_vs_bloodO&quot;</span><span class=p>,</span><span class=w> </span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=w>                                                 </span><span class=s>&quot;bloodtype_bloodB_vs_bloodO&quot;</span><span class=p>))</span>
</code></pre></div> <p>However, following our three steps detailed in the first section, we can define our comparisons from the design matrix:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=c1># define the model matrix</span>
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=n>mod_mat</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>model.matrix</span><span class=p>(</span><span class=nf>design</span><span class=p>(</span><span class=n>dds</span><span class=p>),</span><span class=w> </span><span class=nf>colData</span><span class=p>(</span><span class=n>dds</span><span class=p>))</span>
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=n>mod_mat</span>
</code></pre></div> <div class=highlight><pre><span></span><code>##         (Intercept) bloodtypebloodA bloodtypebloodB
## sample1           1               1               0
## sample2           1               1               0
## sample3           1               1               0
## sample4           1               0               1
## sample5           1               0               1
## sample6           1               0               1
## sample7           1               0               0
## sample8           1               0               0
## sample9           1               0               0
## attr(,&quot;assign&quot;)
## [1] 0 1 1
## attr(,&quot;contrasts&quot;)
## attr(,&quot;contrasts&quot;)$bloodtype
## [1] &quot;contr.treatment&quot;
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1># calculate coefficient vectors for each group</span>
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=n>bloodA</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;bloodA&quot;</span><span class=p>,</span><span class=w> </span><span class=p>])</span>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=n>bloodB</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;bloodB&quot;</span><span class=p>,</span><span class=w> </span><span class=p>])</span>
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=n>bloodO</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;bloodO&quot;</span><span class=p>,</span><span class=w> </span><span class=p>])</span>
</code></pre></div> <p>And we can now define any contrasts we want:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1># obtain results for each pairwise contrast</span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=n>res2_bloodA_bloodO</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bloodA</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>bloodO</span><span class=p>)</span>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=n>res2_bloodB_bloodO</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bloodB</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>bloodO</span><span class=p>)</span>
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=n>res2_bloodA_bloodB</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bloodA</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>bloodB</span><span class=p>)</span>
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=c1># plot the results from the two approaches to check that they are identical</span>
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=nf>plot</span><span class=p>(</span><span class=n>res1_bloodA_bloodO</span><span class=o>$</span><span class=n>log2FoldChange</span><span class=p>,</span><span class=w> </span><span class=n>res2_bloodA_bloodO</span><span class=o>$</span><span class=n>log2FoldChange</span><span class=p>)</span>
<a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=nf>plot</span><span class=p>(</span><span class=n>res1_bloodB_bloodO</span><span class=o>$</span><span class=n>log2FoldChange</span><span class=p>,</span><span class=w> </span><span class=n>res2_bloodB_bloodO</span><span class=o>$</span><span class=n>log2FoldChange</span><span class=p>)</span>
<a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=nf>plot</span><span class=p>(</span><span class=n>res1_bloodA_bloodB</span><span class=o>$</span><span class=n>log2FoldChange</span><span class=p>,</span><span class=w> </span><span class=n>res2_bloodA_bloodB</span><span class=o>$</span><span class=n>log2FoldChange</span><span class=p>)</span>
</code></pre></div> <h3 id=a-and-b-against-o>A and B against O<a class=headerlink href=#a-and-b-against-o title="Permanent link">&para;</a></h3> <p>With this approach, we could even define a more unusual contrast, for example to find genes that differ between A and B against and O samples:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c1># define vector of coefficients for A_B samples</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=n>A_B</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>%in%</span><span class=w> </span><span class=nf>c</span><span class=p>(</span><span class=s>&quot;bloodA&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;bloodB&quot;</span><span class=p>),])</span>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=c1># Our contrast of interest is</span>
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=n>A_B</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>bloodO</span>
</code></pre></div> <div class=highlight><pre><span></span><code>##     (Intercept) bloodtypebloodA bloodtypebloodB 
##             0.0             0.5             0.5
</code></pre></div> <p>Notice the contrast vector in this case assigns a "weight" of 0.5 to each of <code>bloodtypebloodA</code> and <code>bloodtypebloodB</code>. This is equivalent to saying that we want to consider the average of bloodA and bloodB expression. In fact, we could have also defined our contrast vector like this:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=c1># average of bloodA and bloodB minus bloodO</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=p>(</span><span class=n>bloodA</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>bloodB</span><span class=p>)</span><span class=o>/</span><span class=m>2</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>bloodO</span>
</code></pre></div> <div class=highlight><pre><span></span><code>##     (Intercept) bloodtypebloodA bloodtypebloodB 
##             0.0             0.5             0.5
</code></pre></div> <p>To obtain our results, we use the <code>results()</code> function as before:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=c1># get the results between A_B and bloodA</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=n>res2_AB</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>A_B</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>bloodO</span><span class=p>)</span>
</code></pre></div> <h3 id=extra-why-not-define-a-new-group-in-our-design-matrix>Extra: why not define a new group in our design matrix?<a class=headerlink href=#extra-why-not-define-a-new-group-in-our-design-matrix title="Permanent link">&para;</a></h3> <p>For this last example (A_B vs bloodO), we may have considered creating a new variable in our column data:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=n>dds</span><span class=o>$</span><span class=n>A_B</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>factor</span><span class=p>(</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>%in%</span><span class=w> </span><span class=nf>c</span><span class=p>(</span><span class=s>&quot;bloodA&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;bloodB&quot;</span><span class=p>))</span>
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=nf>colData</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>## DataFrame with 9 rows and 3 columns
##         bloodtype sizeFactor      A_B
##          &lt;factor&gt;  &lt;numeric&gt; &lt;factor&gt;
## sample1    bloodA   0.972928    TRUE 
## sample2    bloodA   0.985088    TRUE 
## sample3    bloodA   0.960749    TRUE 
## sample4    bloodB   0.916582    TRUE 
## sample5    bloodB   0.936918    TRUE 
## sample6    bloodB   1.137368    TRUE 
## sample7    bloodO   1.071972    FALSE
## sample8    bloodO   1.141490    FALSE
## sample9    bloodO   1.140135    FALSE
</code></pre></div> <p>and then re-run DESeq with a new design:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=nf>design</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=o>~</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>A_B</span>
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=n>dds</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>DESeq</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span>
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=nf>resultsNames</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>## [1] &quot;Intercept&quot;         &quot;A_B_TRUE_vs_FALSE&quot;
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=n>res1_A_B</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>list</span><span class=p>(</span><span class=s>&quot;A_B_TRUE_vs_FALSE&quot;</span><span class=p>))</span>
</code></pre></div> <p>However, in this model the gene dispersion is estimated together for bloodA and bloodB samples as if they were replicates of each other, which may result in inflated/deflated estimates. Instead, our approach above estimates the error within each of those groups.</p> <p>To check the difference one could compare the two approaches visually:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=c1># compare the log-fold-changes between the two approaches</span>
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=nf>plot</span><span class=p>(</span><span class=n>res1_A_B</span><span class=o>$</span><span class=n>log2FoldChange</span><span class=p>,</span><span class=w> </span><span class=n>res2_AB</span><span class=o>$</span><span class=n>log2FoldChange</span><span class=p>)</span>
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=nf>abline</span><span class=p>(</span><span class=m>0</span><span class=p>,</span><span class=w> </span><span class=m>1</span><span class=p>,</span><span class=w> </span><span class=n>col</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;brown&quot;</span><span class=p>,</span><span class=w> </span><span class=n>lwd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>2</span><span class=p>)</span>
</code></pre></div> <p><img src=./img/07_extra_contrast_design/contrast_res3.png width=960 style="display: block; margin: auto;"></p> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=c1># compare the errors between the two approaches</span>
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=nf>plot</span><span class=p>(</span><span class=n>res1_A_B</span><span class=o>$</span><span class=n>lfcSE</span><span class=p>,</span><span class=w> </span><span class=n>res2_AB</span><span class=o>$</span><span class=n>lfcSE</span><span class=p>)</span>
<a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=nf>abline</span><span class=p>(</span><span class=m>0</span><span class=p>,</span><span class=w> </span><span class=m>1</span><span class=p>,</span><span class=w> </span><span class=n>col</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;brown&quot;</span><span class=p>,</span><span class=w> </span><span class=n>lwd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>2</span><span class=p>)</span>
</code></pre></div> <p><img src=./img/07_extra_contrast_design/contrast_res4.png width=960 style="display: block; margin: auto;"></p> <h2 id=two-factors-with-interaction>Two factors with interaction<a class=headerlink href=#two-factors-with-interaction title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=c1># simulate data</span>
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=n>dds</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>makeExampleDESeqDataSet</span><span class=p>(</span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>1000</span><span class=p>,</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>12</span><span class=p>,</span><span class=w> </span><span class=n>betaSD</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>2</span><span class=p>)</span>
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>factor</span><span class=p>(</span><span class=nf>rep</span><span class=p>(</span><span class=nf>c</span><span class=p>(</span><span class=s>&quot;bloodO&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;bloodA&quot;</span><span class=p>),</span><span class=w> </span><span class=n>each</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>6</span><span class=p>))</span>
<a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>relevel</span><span class=p>(</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=p>,</span><span class=w> </span><span class=s>&quot;bloodO&quot;</span><span class=p>)</span>
<a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>factor</span><span class=p>(</span><span class=nf>rep</span><span class=p>(</span><span class=nf>c</span><span class=p>(</span><span class=s>&quot;treat&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;control&quot;</span><span class=p>),</span><span class=w> </span><span class=m>6</span><span class=p>))</span>
<a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a><span class=n>dds</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=n>dds</span><span class=p>[,</span><span class=w> </span><span class=nf>order</span><span class=p>(</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=p>,</span><span class=w> </span><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=p>)]</span>
<a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=nf>colnames</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>paste0</span><span class=p>(</span><span class=s>&quot;sample&quot;</span><span class=p>,</span><span class=w> </span><span class=m>1</span><span class=o>:</span><span class=nf>ncol</span><span class=p>(</span><span class=n>dds</span><span class=p>))</span>
</code></pre></div> <p>First let’s look at our sample information:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=nf>colData</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>## DataFrame with 12 rows and 2 columns
##          condition bloodtype
##           &lt;factor&gt;  &lt;factor&gt;
## sample1    control    bloodO
## sample2    control    bloodO
## sample3    control    bloodO
## sample4    treat      bloodO
## sample5    treat      bloodO
## ...            ...       ...
## sample8    control    bloodA
## sample9    control    bloodA
## sample10   treat      bloodA
## sample11   treat      bloodA
## sample12   treat      bloodA
</code></pre></div> <p>This time we have two factors of interest, and we want to model both with an interaction (i.e. we assume that bloodA and bloodO samples may respond differently to treat/control). We define our design accordingly and fit the model:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=nf>design</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=o>~</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>bloodtype</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>condition</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>bloodtype</span><span class=o>:</span><span class=n>condition</span>
<a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=n>dds</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>DESeq</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span>
<a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=nf>resultsNames</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>## [1] &quot;Intercept&quot;                      &quot;bloodtype_bloodA_vs_bloodO&quot;    
## [3] &quot;condition_treat_vs_control&quot;     &quot;bloodtypebloodA.conditiontreat&quot;
</code></pre></div> <p>Because we have two factors and an interaction, the number of comparisons we can do is larger. Using our three-step approach from the model matrix, we do things exactly as we’ve been doing so far:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=c1># get the model matrix</span>
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=n>mod_mat</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>model.matrix</span><span class=p>(</span><span class=nf>design</span><span class=p>(</span><span class=n>dds</span><span class=p>),</span><span class=w> </span><span class=nf>colData</span><span class=p>(</span><span class=n>dds</span><span class=p>))</span>
<a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=c1># Define coefficient vectors for each condition</span>
<a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=n>bloodO_control</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;bloodO&quot;</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;control&quot;</span><span class=p>,</span><span class=w> </span><span class=p>])</span>
<a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a><span class=n>bloodO_treat</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;bloodO&quot;</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;treat&quot;</span><span class=p>,</span><span class=w> </span><span class=p>])</span>
<a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a><span class=n>bloodA_control</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;bloodA&quot;</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;control&quot;</span><span class=p>,</span><span class=w> </span><span class=p>])</span>
<a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a><span class=n>bloodA_treat</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;bloodA&quot;</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;treat&quot;</span><span class=p>,</span><span class=w> </span><span class=p>])</span>
</code></pre></div> <p>We are now ready to define any contrast of interest from these vectors (for completeness we show the equivalent syntax using the coefficient’s names from DESeq).</p> <p>bloodA vs bloodO (in the control):</p> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=n>res1</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bloodA_control</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>bloodO_control</span><span class=p>)</span>
<a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a><span class=c1># or equivalently</span>
<a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=n>res2</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>list</span><span class=p>(</span><span class=s>&quot;bloodtype_bloodA_vs_bloodO&quot;</span><span class=p>))</span>
</code></pre></div> <p>bloodA vs bloodO (in the treatment):</p> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=n>res1</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bloodO_treat</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>bloodA_treat</span><span class=p>)</span>
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=c1># or equivalently</span>
<a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=n>res2</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>list</span><span class=p>(</span><span class=nf>c</span><span class=p>(</span><span class=s>&quot;bloodtype_bloodA_vs_bloodO&quot;</span><span class=p>,</span>
<a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=w>                                       </span><span class=s>&quot;bloodtypebloodA.conditiontreat&quot;</span><span class=p>)))</span>
</code></pre></div> <p>treat vs control (for bloodtypes O):</p> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=n>res1</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bloodO_treat</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>bloodO_control</span><span class=p>)</span>
<a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=c1># or equivalently</span>
<a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=n>res2</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>list</span><span class=p>(</span><span class=nf>c</span><span class=p>(</span><span class=s>&quot;condition_treat_vs_control&quot;</span><span class=p>)))</span>
</code></pre></div> <p>treat vs control (for bloodtypes A):</p> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=n>res1</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bloodA_treat</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>bloodA_control</span><span class=p>)</span>
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=c1># or equivalently</span>
<a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=n>res2</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>list</span><span class=p>(</span><span class=nf>c</span><span class=p>(</span><span class=s>&quot;condition_treat_vs_control&quot;</span><span class=p>,</span><span class=w> </span>
<a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=w>                                       </span><span class=s>&quot;bloodtypebloodA.conditiontreat&quot;</span><span class=p>)))</span>
</code></pre></div> <p>Interaction between bloodtype and condition</p> <p>I.e. do bloodAs and bloodOs respond differently to the treatment?</p> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=n>res1</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span>
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=w>                </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>bloodA_treat</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>bloodA_control</span><span class=p>)</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=p>(</span><span class=n>bloodO_treat</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>bloodO_control</span><span class=p>))</span>
<a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=c1># or equivalently</span>
<a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=n>res2</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>list</span><span class=p>(</span><span class=s>&quot;bloodtypebloodA.conditiontreat&quot;</span><span class=p>))</span>
</code></pre></div> <p>In conclusion, although we can define these contrasts using DESeq coefficient names, it is somewhat more explicit (and perhaps intuitive?) what it is we’re comparing using matrix-based contrasts.</p> <h2 id=three-factors-with-nesting>Three factors, with nesting<a class=headerlink href=#three-factors-with-nesting title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=c1># simulate data</span>
<a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=n>dds</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>makeExampleDESeqDataSet</span><span class=p>(</span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>1000</span><span class=p>,</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>24</span><span class=p>,</span><span class=w> </span><span class=n>betaSD</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>2</span><span class=p>)</span>
<a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>factor</span><span class=p>(</span><span class=nf>rep</span><span class=p>(</span><span class=nf>c</span><span class=p>(</span><span class=s>&quot;bloodA&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;bloodO&quot;</span><span class=p>),</span><span class=w> </span><span class=n>each</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>12</span><span class=p>))</span>
<a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>relevel</span><span class=p>(</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=p>,</span><span class=w> </span><span class=s>&quot;bloodO&quot;</span><span class=p>)</span>
<a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=n>dds</span><span class=o>$</span><span class=n>patient</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>factor</span><span class=p>(</span><span class=nf>rep</span><span class=p>(</span><span class=kc>LETTERS</span><span class=p>[</span><span class=m>1</span><span class=o>:</span><span class=m>4</span><span class=p>],</span><span class=w> </span><span class=n>each</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>6</span><span class=p>))</span>
<a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>factor</span><span class=p>(</span><span class=nf>rep</span><span class=p>(</span><span class=nf>c</span><span class=p>(</span><span class=s>&quot;treat&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;control&quot;</span><span class=p>),</span><span class=w> </span><span class=m>12</span><span class=p>))</span>
<a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a><span class=n>dds</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=n>dds</span><span class=p>[,</span><span class=w> </span><span class=nf>order</span><span class=p>(</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=p>,</span><span class=w> </span><span class=n>dds</span><span class=o>$</span><span class=n>patient</span><span class=p>,</span><span class=w> </span><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=p>)]</span>
<a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a><span class=nf>colnames</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>paste0</span><span class=p>(</span><span class=s>&quot;sample&quot;</span><span class=p>,</span><span class=w> </span><span class=m>1</span><span class=o>:</span><span class=nf>ncol</span><span class=p>(</span><span class=n>dds</span><span class=p>))</span>
</code></pre></div> <p>First let’s look at our sample information:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=nf>colData</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>## DataFrame with 24 rows and 3 columns
##          condition bloodtype  patient
##           &lt;factor&gt;  &lt;factor&gt; &lt;factor&gt;
## sample1    control    bloodO        C
## sample2    control    bloodO        C
## sample3    control    bloodO        C
## sample4    treat      bloodO        C
## sample5    treat      bloodO        C
## ...            ...       ...      ...
## sample20   control    bloodA        B
## sample21   control    bloodA        B
## sample22   treat      bloodA        B
## sample23   treat      bloodA        B
## sample24   treat      bloodA        B
</code></pre></div> <p>Now we have three factors, but patient is <em>nested</em> within bloodtype (i.e. a patient is either bloodA or bloodO, it cannot be both). Therefore, bloodtype is a linear combination with patient (or, another way to think about it is that bloodtype is redundant with patient). Because of this, we will define our design without including "bloodtype", although later we can compare groups of patient of the same bloodtype with each other.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=nf>design</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=o>~</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>patient</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>condition</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>patient</span><span class=o>:</span><span class=n>condition</span>
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=n>dds</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>DESeq</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span>
<a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=nf>resultsNames</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>## [1] &quot;Intercept&quot;                  &quot;patient_B_vs_A&quot;            
## [3] &quot;patient_C_vs_A&quot;             &quot;patient_D_vs_A&quot;            
## [5] &quot;condition_treat_vs_control&quot; &quot;patientB.conditiontreat&quot;   
## [7] &quot;patientC.conditiontreat&quot;    &quot;patientD.conditiontreat&quot;
</code></pre></div> <p>Now it’s harder to define contrasts between groups of patient of the same bloodtype using DESeq’s coefficient names (although still possible). But using the model matrix approach, we do it in exactly the same way we have done so far!</p> <p>Again, let’s define our groups from the model matrix:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=c1># get the model matrix</span>
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=n>mod_mat</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>model.matrix</span><span class=p>(</span><span class=nf>design</span><span class=p>(</span><span class=n>dds</span><span class=p>),</span><span class=w> </span><span class=nf>colData</span><span class=p>(</span><span class=n>dds</span><span class=p>))</span>
<a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=c1># define coefficient vectors for each group</span>
<a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=n>bloodO_control</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;bloodO&quot;</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;control&quot;</span><span class=p>,</span><span class=w> </span><span class=p>])</span>
<a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a><span class=n>bloodA_control</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;bloodA&quot;</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;control&quot;</span><span class=p>,</span><span class=w> </span><span class=p>])</span>
<a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=n>bloodO_treat</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;bloodO&quot;</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;treat&quot;</span><span class=p>,</span><span class=w> </span><span class=p>])</span>
<a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a><span class=n>bloodA_treat</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;bloodA&quot;</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;treat&quot;</span><span class=p>,</span><span class=w> </span><span class=p>])</span>
</code></pre></div> <p>It’s worth looking at some of these vectors, to see that they are composed of weighted coefficients from different patient. For example, for "bloodO" patient, we have equal contribution from "patientC" and "patientD":</p> <div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=n>bloodO_control</span>
</code></pre></div> <div class=highlight><pre><span></span><code>##             (Intercept)                patientB                patientC 
##                     1.0                     0.0                     0.5 
##                patientD          conditiontreat patientB:conditiontreat 
##                     0.5                     0.0                     0.0 
## patientC:conditiontreat patientD:conditiontreat 
##                     0.0                     0.0
</code></pre></div> <p>And so, when we define our contrasts, each patient will be correctly weighted:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=n>bloodO_treat</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>bloodO_control</span>
</code></pre></div> <div class=highlight><pre><span></span><code>##             (Intercept)                patientB                patientC 
##                     0.0                     0.0                     0.0 
##                patientD          conditiontreat patientB:conditiontreat 
##                     0.0                     1.0                     0.0 
## patientC:conditiontreat patientD:conditiontreat 
##                     0.5                     0.5
</code></pre></div> <p>We can set our contrasts in exactly the same way as we did in the previous section (for completeness, we also give the contrasts using DESeq’s named coefficients).</p> <p>bloodA vs bloodO (in the control):</p> <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=n>res1_bloodA_bloodO_control</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bloodA_control</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>bloodO_control</span><span class=p>)</span>
<a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=c1># or equivalently</span>
<a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a><span class=n>res2_bloodA_bloodO_control</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span>
<a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a><span class=w>                                 </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>list</span><span class=p>(</span><span class=nf>c</span><span class=p>(</span><span class=s>&quot;patient_B_vs_A&quot;</span><span class=p>),</span><span class=w> </span><span class=c1># Blood type A</span>
<a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a><span class=w>                                                 </span><span class=nf>c</span><span class=p>(</span><span class=s>&quot;patient_C_vs_A&quot;</span><span class=p>,</span><span class=w> </span><span class=c1># Blood type O</span>
<a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a><span class=w>                                                   </span><span class=s>&quot;patient_D_vs_A&quot;</span><span class=p>)))</span><span class=w> </span><span class=c1># Blood type O</span>
</code></pre></div> <p>bloodA vs bloodO (in the treat):</p> <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=n>res1_bloodO_bloodA_treat</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bloodO_treat</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>bloodA_treat</span><span class=p>)</span>
<a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class=c1># or equivalently</span>
<a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=n>res2_bloodO_bloodA_treat</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>results</span><span class=p>(</span><span class=n>dds</span><span class=p>,</span><span class=w> </span>
<a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a><span class=w>                           </span><span class=n>contrast</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>list</span><span class=p>(</span><span class=nf>c</span><span class=p>(</span><span class=s>&quot;patient_B_vs_A&quot;</span><span class=p>,</span><span class=w> </span><span class=c1># Blood type A</span>
<a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a><span class=w>                                             </span><span class=s>&quot;patientB.conditiontreat&quot;</span><span class=p>),</span><span class=w> </span><span class=c1># Interaction of patient B with treatment</span>
<a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a><span class=w>                                           </span><span class=nf>c</span><span class=p>(</span><span class=s>&quot;patient_C_vs_A&quot;</span><span class=p>,</span><span class=w> </span><span class=c1># Blood type O</span>
<a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a><span class=w>                                             </span><span class=s>&quot;patient_D_vs_A&quot;</span><span class=p>,</span><span class=w> </span><span class=c1># Blood type O</span>
<a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a><span class=w>                                             </span><span class=s>&quot;patientC.conditiontreat&quot;</span><span class=p>,</span><span class=w> </span><span class=c1># Interaction of patient C with treatment</span>
<a id=__codelineno-48-9 name=__codelineno-48-9 href=#__codelineno-48-9></a><span class=w>                                             </span><span class=s>&quot;patientD.conditiontreat&quot;</span><span class=p>)))</span><span class=w> </span><span class=c1># Interaction of patient B with treatment</span>
</code></pre></div> <p>And so on, for other contrasts of interest…</p> <hr> <h2 id=extra-imbalanced-design>Extra: imbalanced design<a class=headerlink href=#extra-imbalanced-design title="Permanent link">&para;</a></h2> <p>Let’s take our previous example, but drop one of the samples from the data, so that we only have 2 replicates for it.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=n>dds</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=n>dds</span><span class=p>[,</span><span class=w> </span><span class=m>-1</span><span class=p>]</span><span class=w> </span><span class=c1># drop one of the patient C samples</span>
<a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=n>dds</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>DESeq</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span>
<a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=nf>resultsNames</span><span class=p>(</span><span class=n>dds</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>## [1] &quot;Intercept&quot;                  &quot;patient_B_vs_A&quot;            
## [3] &quot;patient_C_vs_A&quot;             &quot;patient_D_vs_A&quot;            
## [5] &quot;condition_treat_vs_control&quot; &quot;patientB.conditiontreat&quot;   
## [7] &quot;patientC.conditiontreat&quot;    &quot;patientD.conditiontreat&quot;
</code></pre></div> <p>Define our model matrix and coefficient vectors:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=n>mod_mat</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>model.matrix</span><span class=p>(</span><span class=nf>design</span><span class=p>(</span><span class=n>dds</span><span class=p>),</span><span class=w> </span><span class=nf>colData</span><span class=p>(</span><span class=n>dds</span><span class=p>))</span>
<a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=n>mod_mat</span>
</code></pre></div> <div class=highlight><pre><span></span><code>##          (Intercept) patientB patientC patientD conditiontreat
## sample2            1        0        1        0              0
## sample3            1        0        1        0              0
## sample4            1        0        1        0              1
## sample5            1        0        1        0              1
## sample6            1        0        1        0              1
## sample7            1        0        0        1              0
## sample8            1        0        0        1              0
## sample9            1        0        0        1              0
## sample10           1        0        0        1              1
## sample11           1        0        0        1              1
## sample12           1        0        0        1              1
## sample13           1        0        0        0              0
## sample14           1        0        0        0              0
## sample15           1        0        0        0              0
## sample16           1        0        0        0              1
## sample17           1        0        0        0              1
## sample18           1        0        0        0              1
## sample19           1        1        0        0              0
## sample20           1        1        0        0              0
## sample21           1        1        0        0              0
## sample22           1        1        0        0              1
## sample23           1        1        0        0              1
## sample24           1        1        0        0              1
##          patientB:conditiontreat patientC:conditiontreat
## sample2                        0                       0
## sample3                        0                       0
## sample4                        0                       1
## sample5                        0                       1
## sample6                        0                       1
## sample7                        0                       0
## sample8                        0                       0
## sample9                        0                       0
## sample10                       0                       0
## sample11                       0                       0
## sample12                       0                       0
## sample13                       0                       0
## sample14                       0                       0
## sample15                       0                       0
## sample16                       0                       0
## sample17                       0                       0
## sample18                       0                       0
## sample19                       0                       0
## sample20                       0                       0
## sample21                       0                       0
## sample22                       1                       0
## sample23                       1                       0
## sample24                       1                       0
##          patientD:conditiontreat
## sample2                        0
## sample3                        0
## sample4                        0
## sample5                        0
## sample6                        0
## sample7                        0
## sample8                        0
## sample9                        0
## sample10                       1
## sample11                       1
## sample12                       1
## sample13                       0
## sample14                       0
## sample15                       0
## sample16                       0
## sample17                       0
## sample18                       0
## sample19                       0
## sample20                       0
## sample21                       0
## sample22                       0
## sample23                       0
## sample24                       0
## attr(,&quot;assign&quot;)
## [1] 0 1 1 1 2 3 3 3
## attr(,&quot;contrasts&quot;)
## attr(,&quot;contrasts&quot;)$patient
## [1] &quot;contr.treatment&quot;
## 
## attr(,&quot;contrasts&quot;)$condition
## [1] &quot;contr.treatment&quot;
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=c1># define coefficient vectors for each group</span>
<a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=n>bloodO_control</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;bloodO&quot;</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;control&quot;</span><span class=p>,</span><span class=w> </span><span class=p>])</span>
<a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=n>bloodA_control</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;bloodA&quot;</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;control&quot;</span><span class=p>,</span><span class=w> </span><span class=p>])</span>
<a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a><span class=n>bloodO_treat</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;bloodO&quot;</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;treat&quot;</span><span class=p>,</span><span class=w> </span><span class=p>])</span>
<a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a><span class=n>bloodA_treat</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>colMeans</span><span class=p>(</span><span class=n>mod_mat</span><span class=p>[</span><span class=n>dds</span><span class=o>$</span><span class=n>bloodtype</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;bloodA&quot;</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>dds</span><span class=o>$</span><span class=n>condition</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;treat&quot;</span><span class=p>,</span><span class=w> </span><span class=p>])</span>
</code></pre></div> <p>Now let’s check what happens to the bloodO_control group:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=n>bloodO_control</span>
</code></pre></div> <div class=highlight><pre><span></span><code>##             (Intercept)                patientB                patientC 
##                     1.0                     0.0                     0.4 
##                patientD          conditiontreat patientB:conditiontreat 
##                     0.6                     0.0                     0.0 
## patientC:conditiontreat patientD:conditiontreat 
##                     0.0                     0.0
</code></pre></div> <p>Notice that whereas before "patientC" and "patientD" had each a weight of 0.5, now they have different weights. That’s because for patientC there’s only 2 replicates. So, we have a total of 5 bloodtype O individuals in the control (2 from patient C and 3 from D). Therefore, when we calculate the average coefficients for bloodOs, we need to do it as 0.4 x patientC + 0.6 x patientD.</p> <p>The nice thing about this approach is that we do not need to worry about any of this, the weights come from our <code>colMeans()</code> call automatically. And now, any contrasts that we make will take these weights into account:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=c1># bloodA vs bloodO (in the control)</span>
<a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a><span class=n>bloodA_control</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>bloodO_control</span>
</code></pre></div> <div class=highlight><pre><span></span><code>##             (Intercept)                patientB                patientC 
##                     0.0                     0.5                    -0.4 
##                patientD          conditiontreat patientB:conditiontreat 
##                    -0.6                     0.0                     0.0 
## patientC:conditiontreat patientD:conditiontreat 
##                     0.0                     0.0
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=c1># interaction</span>
<a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=p>(</span><span class=n>bloodA_treat</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>bloodA_control</span><span class=p>)</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=p>(</span><span class=n>bloodO_treat</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>bloodO_control</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>##             (Intercept)                patientB                patientC 
##                     0.0                     0.0                    -0.1 
##                patientD          conditiontreat patientB:conditiontreat 
##                     0.1                     0.0                     0.5 
## patientC:conditiontreat patientD:conditiontreat 
##                    -0.5                    -0.5
</code></pre></div> <hr> <p><em>Part of this lesson was originally developed by members of the teaching team (Mary Piper, Meeta Mistry, Radhika Khetani) at the <a href=http://bioinformatics.sph.harvard.edu/ >Harvard Chan Bioinformatics Core (HBC)</a>.</em></p> <p><em>In addition, we would like to thank <a href=https://bioinfotraining.bio.cam.ac.uk/about>Hugo Tavares</a> from the Bioinformatics Training Facility of the University of Cambridge.</em></p> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=06_exploratory_analysis.html class="md-footer__link md-footer__link--prev" aria-label="Previous: Exploratory Analysis" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Exploratory Analysis </div> </div> </a> <a href=07a_DEA.html class="md-footer__link md-footer__link--next" aria-label="Next: DESeq2" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> DESeq2 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/hds-sandbox target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://twitter.com/ucph_heads target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": ".", "features": ["content.code.annotate", "content.tooltips", "navigation.indexes", "navigation.sections", "navigation.footer", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=assets/javascripts/bundle.5a2dcb6a.min.js></script> <script src=javascripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>